# SHG (Second Harmonic Generation) Simulation

这是一个基于PyQt5的非线性光学SHG效应模拟程序。用户可以选择不同的晶体点群，调整入射光参数和晶体朝向，并可视化产生的二次谐波强度。

## 功能特性

*   通过点群选择自动生成非线性张量模板。
*   通过滑块调整主要参数：
    *   入射光方位角 (phi)
    *   张量整体强度
    *   各独立非零张量分量的相对强度 (通过双击滑块可重置)
*   手动输入3x6的d_ij张量。
*   预设多种晶体材料 (MoS2, BaTiO3, LiNbO3, KDP)。
*   多种扫描模式和输入光偏振控制：
    *   默认扫描 (θ-极图)：扫描入射光天顶角θ (0-360°)，固定phi角和输入偏振，输出SHG强度极坐标图。
    *   偏振角扫描 (α vs I)：固定入射光方向(固定θ, 固定phi)，扫描线偏振光的偏振角α (0-360°)，输出SHG强度 vs α 的笛卡尔坐标图。
    *   偏振角扫描 (α-强度极图)：与上一模式数据相同，但输出为SHG强度 vs α 的极坐标图。
    *   输入光偏振模式可选：默认(θ-偏振，等效于线偏振α=0°)，线偏振 (可调α角)，左旋圆偏振 (LCP)，右旋圆偏振 (RCP)。
*   晶体朝向控制：通过三个欧拉角 (φ_c, θ_c, ψ_c) 控制晶体在实验室坐标系中的朝向。
*   检测偏振选择：总强度 |P|², 平行模式 (∥)，垂直模式 (⊥)。
*   动态显示非零张量分量。
*   图形界面参数调整与实时绘图更新。

## To-Do List / 未来功能

### P1: 核心物理 & 可用性
1.  ~~输入光偏振控制 (线偏振-alpha角, 圆偏振-LCP/RCP)~~ (已完成)
2.  ~~晶体朝向控制 (欧拉角)~~ (已完成)
3.  数据导出 (计算结果和图像，例如 CSV, TXT, PNG等格式)
4.  扩展预设材料库，并允许用户保存/加载自定义材料参数。

### P2: 分析 & 可视化
5.  SHG 输出光的偏振分析 (例如计算斯托克斯参数并可视化输出光的偏振态椭圆)。

### P3: 高级物理 (长期考虑)
6.  波长依赖性 和 相位匹配条件 的考量 (例如 Sellmeier 方程，折射率匹配)。
7.  **3D SHG 图案可视化** (当前正在进行)。

### 持续进行: 代码优化
*   移除未使用/冗余代码 (部分完成)。
*   提高代码的模块化和可维护性。
*   完善代码注释和文档。

## 安装与运行

1.  确保已安装 Python 3.x。
2.  安装必要的库:
    ```bash
    pip install numpy matplotlib PyQt5
    ```
3.  运行主程序:
    ```bash
    python src/main.py
    ```

## 坐标系约定 (简要说明)

*   **实验室坐标系**: (X, Y, Z) 是固定的参考系。
*   **入射光**:
    *   传播方向 `k` 由光束天顶角 `theta_beam` (与Z轴夹角) 和光束方位角 `phi_beam` (在XY平面内与X轴夹角) 定义。
    *   线偏振角 `alpha` 定义为电场 `E_omega` 与 `vec_theta` 基矢量的夹角。`vec_theta` 和 `vec_phi` 是垂直于 `k` 的两个正交单位矢量。
*   **晶体坐标系**: (x_c, y_c, z_c) 是晶体的内禀坐标系。非线性张量在此坐标系下定义。
*   **欧拉角 (ZYZ约定)**: (φ_c, θ_c, ψ_c) 将晶体坐标系旋转到实验室坐标系。
    1.  绕Z轴旋转 φ_c。
    2.  绕新的Y'轴旋转 θ_c。
    3.  绕新的Z''轴旋转 ψ_c。

## 贡献

欢迎提出问题、报告BUG或贡献代码。