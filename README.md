# SHG 极化模拟器

本项目是一个基于 Python 和 PyQt5 开发的图形用户界面 (GUI) 应用，用于模拟和可视化材料的二次谐波产生 (SHG) 响应。用户可以根据晶体的点群对称性、自定义非线性光学张量、调整入射光参数（如偏振态、入射角度）以及晶体朝向，来计算和显示SHG强度随不同参数变化的极坐标图、笛卡尔坐标图以及三维强度分布图。

## 主要功能

*   **晶体点群选择**: 支持32种晶体点群，根据所选点群自动构建基础的非线性极化张量形式。
*   **常见晶体预设**: 内置常见非线性晶体（如 LiNbO3, KDP）的预设参数，方便快速加载和模拟。
*   **张量分量自定义**:
    *   允许用户通过滑块调整点群允许的各独立非线性张量分量 (d<sub>ij</sub> 或 χ<sup>(2)</sup><sub>ijk</sub>) 的相对大小和符号。
    *   支持对张量进行整体缩放。
*   **入射光参数控制**:
    *   **扫描模式**:
        *   **入射角扫描 (θ-极图)**: 扫描入射光的天顶角 θ (0-360°)，在固定光束方位角 φ 和固定入射光偏振态下，绘制SHG强度作为角度函数的极坐标图。
        *   **偏振角扫描 (α vs I - 笛卡尔图)**: 在固定入射光方向 (θ<sub>inc</sub>, φ<sub>inc</sub>) 下，扫描入射线偏振光的偏振角度 α (0-360°)，绘制SHG强度作为 α 的笛卡尔坐标图。
        *   **偏振角扫描 (α-强度极图)**: 与上一模式类似，但将强度作为 α 的函数在极坐标下显示。
        *   **3D θ<sub>inc</sub>-α<sub>inc</sub> 扫描**: 同时扫描入射光的天顶角 θ<sub>inc</sub> (0-180°) 和线偏振角 α<sub>inc</sub> (0-360°)，在固定的入射光束方位角 φ<sub>inc</sub> 下，将SHG强度显示为三维球面图，其中径向距离代表强度。
    *   **入射光偏振态**: 对于入射角扫描模式，支持选择默认 (p-偏振近似)、线偏振 (可调偏振角 α)、左旋圆偏振 (LCP) 和右旋圆偏振 (RCP)。
    *   **固定入射角/方位角**: 在α扫描和3D扫描模式下，用户可以指定固定的入射天顶角 θ<sub>inc</sub> 和光束方位角 φ<sub>inc</sub>。
*   **晶体朝向控制**: 通过三个欧拉角 (φ<sub>c</sub>, θ<sub>c</sub>, ψ<sub>c</sub> - ZYZ约定) 控制晶体坐标系相对于实验室坐标系的朝向，从而模拟不同切割和取向的晶体。
*   **SHG信号检测**:
    *   **总强度**: 计算总的SHG信号强度 |P<sub>2ω</sub>|²。
    *   **平行模式 (∥)**: 计算SHG信号中平行于入射光在XY平面偏振投影方向的分量的强度。
    *   **垂直模式 (⊥)**: 计算SHG信号中垂直于入射光在XY平面偏振投影方向的分量的强度。
*   **可视化**:
    *   使用 Matplotlib 实时绘制2D极坐标图和笛卡尔坐标图。
    *   使用 Matplotlib 的 `mpl_toolkits.mplot3d` 绘制3D的SHG强度分布图。
*   **手动输入模式**: 提供一个独立的窗口，允许用户直接以3x6矩阵形式手动输入Voigt表示的 d<sub>ij</sub> 系数，并进行模拟。
*   **3D SHG出射方向图 (旧功能)**: 能够基于固定的入射光和晶体参数，计算并显示SHG信号在空间中的辐射方向图（当前3D绘图按钮优先调用新的 θ<sub>inc</sub>-α<sub>inc</sub> 扫描）。

## 技术栈

*   **Python 3**: 主要编程语言。
*   **PyQt5**: 用于构建图形用户界面。
*   **NumPy**: 用于高效的数值计算和张量操作。
*   **Matplotlib**: 用于数据可视化和绘图。

## 运行指南

### 依赖项

确保您的 Python 环境中安装了以下库：

```bash
pip install PyQt5 numpy matplotlib
```

### 从源代码运行

1.  克隆或下载本仓库。
2.  确保 `data/point_group_data.json` 文件与 `src` 目录处于正确的相对位置（通常 `data` 和 `src` 在项目根目录下同级）。
3.  在项目根目录下运行主程序：

    ```bash
    python src/main.py
    ```

## 如何打包为可执行文件 (Windows示例)

可以使用 PyInstaller 将此应用打包为单个可执行文件。

1.  安装 PyInstaller:
    ```bash
    pip install pyinstaller
    ```
2.  打开命令行，导航到项目根目录。
3.  运行以下命令来打包 (根据您的项目结构和主脚本名称调整):

    ```bash
    pyinstaller --name SHGSimulator --onefile --windowed --icon=your_icon.ico --add-data "data:data" src/main.py
    ```
    *   `--name SHGSimulator`: 指定输出的exe文件名。
    *   `--onefile`: 打包成单个exe文件。
    *   `--windowed`: 生成无控制台窗口的GUI应用。
    *   `--icon=your_icon.ico`: (可选) 指定应用程序的图标。您需要提供一个 `.ico` 文件。
    *   `--add-data "data:data"`: **非常重要**。这将 `data` 目录及其内容 (特别是 `point_group_data.json`) 复制到打包后的程序中，并使其在运行时可以访问。分隔符可能是 `;` (Windows) 或 `:` (Linux/macOS)，具体取决于您的操作系统和shell。如果 `data` 目录直接在 `src` 目录下，路径可能是 `--add-data "src/data:data"`。请根据您的实际项目结构调整。我们之前修改 `point_groups.py` 的目的就是为了让程序在打包后能正确找到这个 `data` 目录。
    *   `src/main.py`: 指向您的主Python脚本。

4.  打包完成后，可执行文件通常位于项目根目录下的 `dist` 文件夹中。

## 未来可能的改进

*   **更精确的材料数据库**: 引入包含波长依赖的、更广泛的非线性材料的精确 d<sub>ij</sub> 系数值。
*   **相位匹配条件**: 考虑相位匹配对SHG效率的影响。
*   **多层膜结构**: 支持多层薄膜样品中的SHG模拟。
*   **聚焦光束**: 模拟高斯光束等聚焦光束下的SHG。
*   **输出数据导出**: 允许用户将计算结果或图表数据导出为文本或图像文件。
*   **更高级的3D可视化**: 使用更专业的3D可视化库（如 Mayavi, VisPy）以获得更好的性能和交互性。
*   **单位和物理常数**: 明确物理量的单位，并在计算中引入相关物理常数。

## 贡献

欢迎通过提交 Pull Request 或创建 Issues 来贡献代码或提出建议。

## 许可证

本项目采用 [MIT许可证](LICENSE) (如果计划添加LICENSE文件)。